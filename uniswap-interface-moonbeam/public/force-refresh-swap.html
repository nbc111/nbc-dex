<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å¼ºåˆ¶åˆ·æ–° Swap çŠ¶æ€</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        pre { background: #252526; padding: 15px; border-radius: 5px; white-space: pre-wrap; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        button { background: #0e639c; color: white; border: none; padding: 10px 20px; border-radius: 3px; cursor: pointer; margin: 5px; }
        button:hover { background: #1177bb; }
        .section { margin: 20px 0; padding: 15px; background: #2d2d30; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ”§ å¼ºåˆ¶åˆ·æ–° Swap çŠ¶æ€</h1>
    
    <div class="section">
        <h2>æ“ä½œ</h2>
        <button onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>
        <button onclick="reloadPage()">åˆ·æ–°é¡µé¢</button>
        <button onclick="checkMulticallState()">æ£€æŸ¥ Multicall çŠ¶æ€</button>
        <button onclick="injectDebugCode()">æ³¨å…¥è°ƒè¯•ä»£ç </button>
    </div>
    
    <pre id="output"></pre>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.textContent += message + '\n';
        }

        function clearCache() {
            log('æ¸…é™¤ç¼“å­˜ä¸­...');
            try {
                // æ¸…é™¤ localStorage ä¸­çš„ Multicall ç›¸å…³æ•°æ®
                const keys = Object.keys(localStorage);
                let cleared = 0;
                keys.forEach(key => {
                    if (key.includes('multicall') || key.includes('redux')) {
                        localStorage.removeItem(key);
                        cleared++;
                    }
                });
                log(`âœ… å·²æ¸…é™¤ ${cleared} ä¸ªç¼“å­˜é¡¹`);
                log('è¯·åˆ·æ–°é¡µé¢ä»¥åº”ç”¨æ›´æ”¹');
            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`);
            }
        }

        function reloadPage() {
            log('åˆ·æ–°é¡µé¢...');
            window.location.reload(true);
        }

        async function checkMulticallState() {
            log('\n=== æ£€æŸ¥ Multicall çŠ¶æ€ ===');
            try {
                const multicallState = localStorage.getItem('redux_localstorage_simple_multicall');
                if (multicallState) {
                    const parsed = JSON.parse(multicallState);
                    log('æ‰¾åˆ° Multicall Redux çŠ¶æ€');
                    log(`çŠ¶æ€é”®æ•°é‡: ${Object.keys(parsed).length}`);
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰äº¤æ˜“å¯¹ç›¸å…³çš„è°ƒç”¨
                    const pairAddress = '0x28fb030cabb1ee0ca181f23f7004a38d301570bf';
                    const pairKey = Object.keys(parsed).find(key => key.includes(pairAddress.toLowerCase()));
                    if (pairKey) {
                        log(`âœ… æ‰¾åˆ°äº¤æ˜“å¯¹æ•°æ®: ${pairKey}`);
                    } else {
                        log('âš ï¸ æœªæ‰¾åˆ°äº¤æ˜“å¯¹æ•°æ®');
                    }
                } else {
                    log('æœªæ‰¾åˆ° Multicall Redux çŠ¶æ€');
                }
            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`);
            }
        }

        function injectDebugCode() {
            log('\n=== æ³¨å…¥è°ƒè¯•ä»£ç  ===');
            log('è¯·åœ¨ Swap é¡µé¢æ‰“å¼€æ§åˆ¶å°ï¼Œç„¶åè¿è¡Œä»¥ä¸‹ä»£ç ï¼š\n');
            
            const debugCode = `
// åœ¨ Swap é¡µé¢æ§åˆ¶å°è¿è¡Œæ­¤ä»£ç 
(function() {
    console.log('ğŸ” æ£€æŸ¥ Swap çŠ¶æ€...');
    
    // æ£€æŸ¥ Multicall æ•°æ®
    const pairAddress = '0x28fb030cabb1ee0ca181f23f7004a38d301570bf';
    const multicallData = localStorage.getItem('redux_localstorage_simple_multicall');
    
    if (multicallData) {
        const parsed = JSON.parse(multicallData);
        const pairKey = Object.keys(parsed).find(key => 
            key.includes(pairAddress.toLowerCase())
        );
        
        if (pairKey) {
            console.log('âœ… æ‰¾åˆ°äº¤æ˜“å¯¹ Multicall æ•°æ®:', pairKey);
            console.log('æ•°æ®:', parsed[pairKey]);
        } else {
            console.log('âš ï¸ æœªæ‰¾åˆ°äº¤æ˜“å¯¹ Multicall æ•°æ®');
            console.log('å¯ç”¨çš„é”®:', Object.keys(parsed).slice(0, 10));
        }
    } else {
        console.log('âš ï¸ æœªæ‰¾åˆ° Multicall Redux çŠ¶æ€');
    }
    
    // å°è¯•è§¦å‘çŠ¶æ€æ›´æ–°
    console.log('\\nå°è¯•è§¦å‘çŠ¶æ€æ›´æ–°...');
    const swapInput = document.querySelector('#swap-currency-input input');
    const swapOutput = document.querySelector('#swap-currency-output input');
    
    if (swapInput) {
        console.log('æ‰¾åˆ°è¾“å…¥æ¡†ï¼Œå°è¯•è§¦å‘è¾“å…¥äº‹ä»¶...');
        swapInput.dispatchEvent(new Event('input', { bubbles: true }));
        swapInput.dispatchEvent(new Event('change', { bubbles: true }));
    }
    
    console.log('\\nå»ºè®®æ“ä½œï¼š');
    console.log('1. åœ¨ Swap é¡µé¢åˆ‡æ¢ä»£å¸ï¼ˆå…ˆé€‰å…¶ä»–ï¼Œå†é€‰å› NBC/ETHï¼‰');
    console.log('2. ç­‰å¾… 5-10 ç§’');
    console.log('3. å¦‚æœä»ä¸è¡Œï¼Œç¡¬åˆ·æ–°é¡µé¢ (Ctrl+Shift+R)');
})();
`;
            
            log(debugCode);
            log('\nè¯·å¤åˆ¶ä¸Šé¢çš„ä»£ç åˆ° Swap é¡µé¢çš„æ§åˆ¶å°è¿è¡Œ');
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            log('=== ä½¿ç”¨è¯´æ˜ ===');
            log('1. ç‚¹å‡»"æ¸…é™¤ç¼“å­˜"æ¸…é™¤ Multicall ç¼“å­˜');
            log('2. ç‚¹å‡»"åˆ·æ–°é¡µé¢"é‡æ–°åŠ è½½');
            log('3. å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œç‚¹å‡»"æ³¨å…¥è°ƒè¯•ä»£ç "è·å–æ›´å¤šä¿¡æ¯');
            log('\næ³¨æ„ï¼šæ­¤å·¥å…·éœ€è¦åœ¨ Swap é¡µé¢ä½¿ç”¨æ‰èƒ½ç”Ÿæ•ˆ');
        };
    </script>
</body>
</html>
