<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£å¸åˆ—è¡¨è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #58a6ff; }
        h2 { color: #79c0ff; margin-top: 30px; }
        .info {
            background: #161b22;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #30363d;
        }
        .success { color: #3fb950; }
        .error { color: #f85149; }
        .warning { color: #d29922; }
        pre {
            background: #0d1117;
            padding: 15px;
            border: 1px solid #30363d;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #2ea043; }
        button.danger {
            background: #da3633;
        }
        button.danger:hover { background: #f85149; }
        .token-item {
            padding: 8px;
            margin: 4px 0;
            background: #161b22;
            border-radius: 4px;
            border-left: 3px solid #238636;
        }
        .token-item.missing {
            border-left-color: #f85149;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ä»£å¸åˆ—è¡¨è°ƒè¯•å·¥å…·</h1>
    
    <div class="info">
        <p>æ­¤å·¥å…·ç”¨äºè¯Šæ–­ä¸ºä»€ä¹ˆä»£å¸é€‰æ‹©å¼¹çª—ä¸­åªæ˜¾ç¤ºéƒ¨åˆ†ä»£å¸ã€‚</p>
        <p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong>åœ¨ DEX é¡µé¢ï¼ˆhttp://localhost:3001ï¼‰æ‰“å¼€æ­¤é¡µé¢ï¼Œç„¶åè¿è¡Œä¸‹é¢çš„æ£€æŸ¥ã€‚</p>
    </div>

    <h2>æ“ä½œ</h2>
    <button onclick="checkLocalStorage()">æ£€æŸ¥ localStorage</button>
    <button onclick="checkReduxStore()">æ£€æŸ¥ Redux Store</button>
    <button onclick="checkTokenListFile()">æ£€æŸ¥ tokens.json æ–‡ä»¶</button>
    <button class="danger" onclick="clearCache()">æ¸…é™¤æ‰€æœ‰ç¼“å­˜</button>
    <button onclick="forceRefresh()">å¼ºåˆ¶åˆ·æ–°ä»£å¸åˆ—è¡¨</button>

    <div id="results"></div>

    <h2>è¯´æ˜</h2>
    <div class="info">
        <p><strong>æ£€æŸ¥ localStorageï¼š</strong>æŸ¥çœ‹æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­çš„ä»£å¸åˆ—è¡¨æ•°æ®</p>
        <p><strong>æ£€æŸ¥ Redux Storeï¼š</strong>æŸ¥çœ‹å½“å‰ Redux store ä¸­çš„ä»£å¸åˆ—è¡¨çŠ¶æ€ï¼ˆéœ€è¦ Redux DevToolsï¼‰</p>
        <p><strong>æ£€æŸ¥ tokens.json æ–‡ä»¶ï¼š</strong>éªŒè¯æºæ–‡ä»¶ä¸­çš„ä»£å¸æ•°æ®</p>
        <p><strong>æ¸…é™¤æ‰€æœ‰ç¼“å­˜ï¼š</strong>æ¸…é™¤ localStorage ä¸­çš„æ‰€æœ‰æ•°æ®</p>
        <p><strong>å¼ºåˆ¶åˆ·æ–°ä»£å¸åˆ—è¡¨ï¼š</strong>æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½é¡µé¢</p>
    </div>

    <h2>é¢„æœŸç»“æœ</h2>
    <div class="info">
        <p>tokens.json ä¸­åº”è¯¥æœ‰ <strong>12 ä¸ªä»£å¸</strong>ï¼ˆchainId 1281ï¼‰ï¼š</p>
        <ul id="expected-tokens"></ul>
    </div>

    <script>
        const expectedTokens = [
            { symbol: 'BTC', name: 'Wrapped Bitcoin', address: '0x5EaA2c6ae3bFf47D2188B64F743Ec777733a80ac' },
            { symbol: 'ETH', name: 'Wrapped Ethereum', address: '0x934EbeB6D7D3821B604A5D10F80619d5bcBe49C3' },
            { symbol: 'SOL', name: 'Wrapped Solana', address: '0xd5eeccc885ef850d90ae40e716c3dfce5c3d4c81' },
            { symbol: 'BNB', name: 'Wrapped BNB', address: '0x9c43237490272bfdd2f1d1ca0b34f20b1a3c9f5c' },
            { symbol: 'XRP', name: 'Wrapped XRP', address: '0x48e1772534fabbdcade9ca4005e5ee8bf4190093' },
            { symbol: 'LTC', name: 'Wrapped Litecoin', address: '0x8d22041c22d696fdff0703852a706a40ff65a7de' },
            { symbol: 'DOGE', name: 'Wrapped Dogecoin', address: '0x8ceb9a93405cddf3d76f72327f868bd3e8755d89' },
            { symbol: 'PEPE', name: 'Pepe Token', address: '0xd365877026A43107Efd9825bc3ABFe1d7A450F82' },
            { symbol: 'USDT', name: 'Tether USD', address: '0xfd1508502696d0e1910ed850c6236d965cc4db11' },
            { symbol: 'SUI', name: 'Sui Token', address: '0x9011191e84ad832100ddc891e360f8402457f55e' }
        ];

        // æ˜¾ç¤ºé¢„æœŸä»£å¸åˆ—è¡¨
        const expectedList = document.getElementById('expected-tokens');
        expectedTokens.forEach(token => {
            const li = document.createElement('li');
            li.innerHTML = `<code>${token.symbol}</code> - ${token.name}`;
            expectedList.appendChild(li);
        });

        function showResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            resultsDiv.innerHTML = `<h2>${title}</h2><div class="${className}">${content}</div>`;
        }

        function checkLocalStorage() {
            try {
                const keys = Object.keys(localStorage);
                const reduxKeys = keys.filter(k => k.includes('redux') || k.includes('persist') || k.includes('lists'));
                
                let html = '<h3>LocalStorage ä¸­çš„ Redux ç›¸å…³é”®ï¼š</h3><ul>';
                reduxKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    const size = new Blob([value]).size;
                    html += `<li><code>${key}</code> (${(size / 1024).toFixed(2)} KB)</li>`;
                });
                html += '</ul>';

                // å°è¯•è§£æ lists æ•°æ®
                reduxKeys.forEach(key => {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (data.lists && data.lists.byUrl) {
                            html += '<h3>ä»£å¸åˆ—è¡¨è¯¦æƒ…ï¼š</h3>';
                            Object.keys(data.lists.byUrl).forEach(url => {
                                const list = data.lists.byUrl[url];
                                if (list && list.current && list.current.tokens) {
                                    const tokens = list.current.tokens;
                                    const chain1281Tokens = tokens.filter(t => t.chainId === 1281);
                                    html += `<div class="token-item"><strong>åˆ—è¡¨: ${url}</strong><br>`;
                                    html += `ç‰ˆæœ¬: ${list.current.version.major}.${list.current.version.minor}.${list.current.version.patch}<br>`;
                                    html += `æ€»ä»£å¸æ•°: ${tokens.length}<br>`;
                                    html += `ChainId 1281 ä»£å¸æ•°: ${chain1281Tokens.length}</div>`;
                                    
                                    if (chain1281Tokens.length > 0) {
                                        html += '<h4>ChainId 1281 çš„ä»£å¸ï¼š</h4><ul>';
                                        chain1281Tokens.forEach(token => {
                                            html += `<li><code>${token.symbol}</code> - ${token.name} (${token.address})</li>`;
                                        });
                                        html += '</ul>';
                                    }
                                }
                            });
                        }
                    } catch (e) {
                        // å¿½ç•¥è§£æé”™è¯¯
                    }
                });

                showResult('LocalStorage æ£€æŸ¥ç»“æœ', html);
            } catch (error) {
                showResult('æ£€æŸ¥å¤±è´¥', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        function checkReduxStore() {
            try {
                // å°è¯•ä» window è·å– Redux store
                if (window.__REDUX_DEVTOOLS_EXTENSION__) {
                    showResult('Redux Store æ£€æŸ¥', 'è¯·ä½¿ç”¨ Redux DevTools æµè§ˆå™¨æ‰©å±•æ¥æ£€æŸ¥ store çŠ¶æ€ã€‚', 'info');
                } else {
                    showResult('Redux Store æ£€æŸ¥', 'æœªæ£€æµ‹åˆ° Redux DevToolsã€‚è¯·å®‰è£… Redux DevTools æ‰©å±•ã€‚', 'warning');
                }
            } catch (error) {
                showResult('æ£€æŸ¥å¤±è´¥', `é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function checkTokenListFile() {
            try {
                const response = await fetch('/tokens.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                const chain1281Tokens = data.tokens.filter(t => t.chainId === 1281);
                
                let html = `<h3>tokens.json æ–‡ä»¶å†…å®¹ï¼š</h3>`;
                html += `<p>æ–‡ä»¶ç‰ˆæœ¬: ${data.version.major}.${data.version.minor}.${data.version.patch}</p>`;
                html += `<p>æ€»ä»£å¸æ•°: ${data.tokens.length}</p>`;
                html += `<p><strong>ChainId 1281 ä»£å¸æ•°: ${chain1281Tokens.length}</strong></p>`;
                
                if (chain1281Tokens.length > 0) {
                    html += '<h4>ChainId 1281 çš„ä»£å¸åˆ—è¡¨ï¼š</h4><ul>';
                    chain1281Tokens.forEach(token => {
                        const isExpected = expectedTokens.some(t => t.address.toLowerCase() === token.address.toLowerCase());
                        const className = isExpected ? 'token-item' : 'token-item missing';
                        html += `<li class="${className}"><code>${token.symbol}</code> - ${token.name}<br>åœ°å€: ${token.address}</li>`;
                    });
                    html += '</ul>';
                }

                if (chain1281Tokens.length !== expectedTokens.length) {
                    html += `<div class="error"><strong>è­¦å‘Šï¼š</strong>æ–‡ä»¶ä¸­çš„ä»£å¸æ•°é‡ (${chain1281Tokens.length}) ä¸é¢„æœŸ (${expectedTokens.length}) ä¸åŒ¹é…ï¼</div>`;
                }

                showResult('tokens.json æ–‡ä»¶æ£€æŸ¥', html, chain1281Tokens.length === expectedTokens.length ? 'success' : 'error');
            } catch (error) {
                showResult('æ£€æŸ¥å¤±è´¥', `æ— æ³•è¯»å– tokens.json: ${error.message}`, 'error');
            }
        }

        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ localStorage æ•°æ®å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¾ç½®å’Œäº¤æ˜“å†å²ã€‚')) {
                try {
                    localStorage.clear();
                    showResult('æ¸…é™¤æˆåŠŸ', 'å·²æ¸…é™¤æ‰€æœ‰ localStorage æ•°æ®ã€‚è¯·åˆ·æ–° DEX é¡µé¢æŸ¥çœ‹æ•ˆæœã€‚', 'success');
                } catch (error) {
                    showResult('æ¸…é™¤å¤±è´¥', `é”™è¯¯: ${error.message}`, 'error');
                }
            }
        }

        function forceRefresh() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢å—ï¼Ÿ')) {
                try {
                    // æ¸…é™¤æ‰€æœ‰ Redux ç›¸å…³çš„ç¼“å­˜
                    Object.keys(localStorage).forEach(key => {
                        if (key.includes('redux') || key.includes('persist') || key.includes('lists')) {
                            localStorage.removeItem(key);
                        }
                    });
                    showResult('åˆ·æ–°ä¸­', 'å·²æ¸…é™¤ç¼“å­˜ï¼Œæ­£åœ¨åˆ·æ–°é¡µé¢...', 'success');
                    setTimeout(() => {
                        window.location.href = 'http://localhost:3001';
                    }, 1000);
                } catch (error) {
                    showResult('æ“ä½œå¤±è´¥', `é”™è¯¯: ${error.message}`, 'error');
                }
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            checkTokenListFile();
        };
    </script>
</body>
</html>

